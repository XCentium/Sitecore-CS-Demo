@model CSDemo.Contracts.GeneralSearch.ISearchInput

    @using (Html.BeginForm("SearchInput", "GeneralSearch", FormMethod.Post, new {@id = "global-search-input"}))
    {
        <div id="search-box" class="input-group input-group-lg">
            @Html.HiddenFor(t => Model.RedirectUrl)
            @Html.TextBoxFor(t => Model.Query, new { @class = "form-control", @placeholder = "Search...", @id = "searchInputBox", @autocomplete = "off" })
            <span class="input-group-btn">
                <button class="btn btn-primary" type="submit">Search</button>
            </span>
        </div>
    
        <div id="typeaheadProductsResult"></div>
        <div id="typeaheadCategoryResult"></div>
        <div id="typeaheadBlogArticlesResult"></div>
    }

<script>
window.jQuery ||
    document.write("<script src='http://code.jquery.com/jquery-1.11.0.min.js'>\x3C/script>")
</script>

<script type="text/javascript">
    
    $(document).ready(function () {
        $("#searchInputBox").keyup(function () {
            var queryVal = $(this).val();
            var data = "query:'" + queryVal + "'";

            $("#typeaheadCategoryResult,#typeaheadProductsResult,#typeaheadBlogArticlesResult").html("");

            GetProductsTypeahead(queryVal);
        });

    });

    function GetCategoriesTypeahead(queryVal) {
        var data = "query:'" + queryVal + "'";

        if (queryVal.length > 1) {
            $("#typeaheadCategoryResult").html("");

            $.ajax({
                type: "POST",
                url: "/AJAX/cart.asmx/GetCategoriesResult ",
                data: "{" + data + "}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    console.log("categ");
                    console.log(result);
                    $("#typeaheadCategoryResult").html("");

                    var output = result.d;
                    var categories = output.categories;

                    if (categories && categories.length > 0) {
                        var listHtml = "";
                        var rcnt = 0;

                        $.each(categories,
                            function (i, el) {
                                listHtml +=
                                    "<li>" +
                                    "<a href='" +
                                    el.Url +
                                    "'>" +
                                    el.Title +
                                    "</a>" +
                                    "</li>";
                                rcnt++;
                            });

                        if (rcnt > 0) {
                            listHtml = "<h5>Categories</h5><ul class='search categories'>" + listHtml + "</ul>";

                            $("#typeaheadCategoryResult").append(listHtml);
                            $("#typeaheadCategoryResult").show();
                        }
                    } else {
                        $("#typeaheadCategoryResult").hide();
                    }
                },
                error: function (error) {
                    console.log(error);
                },
                complete: function () {
                    GetBlogArticlesTypeahead(queryVal);
                }
            });
        }
    }

    function GetProductsTypeahead(queryVal) {
        var data = "query:'" + queryVal + "'";

        if (queryVal.length > 1) {
            $.ajax({
                type: "POST",
                url: "/AJAX/cart.asmx/GetProductsResult",
                data: "{" + data + "}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $("#typeaheadProductsResult").html("");

                    var output = result.d;
                    var products = output.products;

                    if (products && products.length > 0) {
                        var listHtml = "";
                        var cnt = 0;
                        var prodImages = [];

                        $.each(products,
                            function (i, el) {
                                // preload image
                                prodImages[cnt] = new Image();
                                prodImages[cnt].src = el.ImageSrc + "?as=1&h=100&w=100";

                                listHtml +=
                                    "<li>" +
                                    "<img src='" +
                                    prodImages[cnt].src +
                                    "' />" +
                                    "<div class='details'><a href='" +
                                    el.Url +
                                    "'>" +
                                    el.Title +
                                    "</a>" +
                                    "<span>" +
                                    el.Price.toFixed(2) + " USD" +
                                    "</span></div>" +
                                    "<div style='clear: both;'></div>" +
                                    "</li>";

                                cnt++;
                            });

                        if (cnt > 0) {
                            listHtml = "<h5>Products</h5><ul class='search products'>" + listHtml + "</ul>";
                            $("#typeaheadProductsResult").append(listHtml);
                            $("#typeaheadProductsResult").show();
                        }
                    } else {
                        $("#typeaheadProductsResult").hide();
                    }
                },
                error: function (error) {
                    console.log(error);
                },
                complete: function () {
                    GetCategoriesTypeahead(queryVal);
                }
            });
        }
    }

    function GetBlogArticlesTypeahead(queryVal) {
        var data = "query:'" + queryVal + "'";

        if (queryVal.length > 1) {
            $.ajax({
                type: "POST",
                url: "/AJAX/cart.asmx/GetBlogArticlesResult",
                data: "{" + data + "}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $("#typeaheadBlogArticlesResult").html("");
                    console.log(result);

                    var output = result.d;
                    var blogs = output.blogs;

                    if (blogs && blogs.length > 0) {
                        var listHtml = "";
                        var rcnt = 0;

                        $.each(blogs, function (i, el) {
                            listHtml +=
                                "<li>" +
                                "<a href='" + el.Url + "'>" + el.Title + "</a>" +
                                "</li>";
                            rcnt++;
                        });

                        if (rcnt > 0) {
                            listHtml = "<h5>Blogs</h5><ul class='search articles'>" + listHtml + "</ul>";

                            $("#typeaheadBlogArticlesResult").append(listHtml);
                        }
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    }
</script>

<div id="imagePreloader">
    
</div>